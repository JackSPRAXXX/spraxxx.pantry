<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPRAXXX Pantry - Divine Court Dashboard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.2em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }
        
        .card h3 {
            margin: 0 0 15px 0;
            color: #667eea;
            font-size: 1.3em;
        }
        
        .severity-counts {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
        }
        
        .severity-item {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            flex: 1;
            margin: 0 5px;
        }
        
        .severity-red {
            background-color: #fee;
            color: #c53030;
            border: 1px solid #feb2b2;
        }
        
        .severity-yellow {
            background-color: #fffbeb;
            color: #d69e2e;
            border: 1px solid #f6e05e;
        }
        
        .severity-green {
            background-color: #f0fff4;
            color: #38a169;
            border: 1px solid #9ae6b4;
        }
        
        .risk-institutions {
            border-left-color: #e53e3e;
        }
        
        .recent-incidents {
            border-left-color: #3182ce;
        }
        
        .fsi-summary {
            border-left-color: #805ad5;
        }
        
        .incident-item {
            padding: 10px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 3px solid #ddd;
        }
        
        .incident-red {
            background-color: #fee;
            border-left-color: #e53e3e;
        }
        
        .incident-yellow {
            background-color: #fffbeb;
            border-left-color: #d69e2e;
        }
        
        .incident-green {
            background-color: #f0fff4;
            border-left-color: #38a169;
        }
        
        .institution-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .institution-item:last-child {
            border-bottom: none;
        }
        
        .fsi-score {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
        }
        
        .fsi-red {
            background-color: #e53e3e;
        }
        
        .fsi-yellow {
            background-color: #d69e2e;
        }
        
        .fsi-green {
            background-color: #38a169;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-red {
            background-color: #e53e3e;
        }
        
        .status-yellow {
            background-color: #d69e2e;
        }
        
        .status-green {
            background-color: #38a169;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9em;
        }
        
        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .refresh-btn:hover {
            background: #5a6fd8;
        }
        
        .alert {
            background: #fed7d7;
            border: 1px solid #feb2b2;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert strong {
            display: block;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>SPRAXXX PANTRY</h1>
        <p>Divine Court Incident Tracker Dashboard</p>
        <p>Nonprofit-only institutional accountability system</p>
    </div>

    <div id="alert-container"></div>

    <div class="dashboard-grid">
        <div class="card">
            <h3>üìä Incident Summary</h3>
            <div id="total-incidents">Loading...</div>
            <div class="severity-counts" id="severity-counts">
                <div class="severity-item severity-red">
                    <div id="red-count">-</div>
                    <div>Critical</div>
                </div>
                <div class="severity-item severity-yellow">
                    <div id="yellow-count">-</div>
                    <div>Moderate</div>
                </div>
                <div class="severity-item severity-green">
                    <div id="green-count">-</div>
                    <div>Low</div>
                </div>
            </div>
            <button class="refresh-btn" onclick="loadDashboardData()">Refresh Data</button>
        </div>

        <div class="card risk-institutions">
            <h3>üéØ High Risk Institutions</h3>
            <div id="risk-institutions">Loading...</div>
        </div>

        <div class="card recent-incidents">
            <h3>üìã Recent Incidents</h3>
            <div id="recent-incidents">Loading...</div>
        </div>

        <div class="card fsi-summary">
            <h3>üìà FSI Overview</h3>
            <div id="fsi-overview">Loading...</div>
        </div>
    </div>

    <div class="footer">
        <p><strong>SPRAXXX Pantry</strong> - Divine Court Incident Tracker</p>
        <p>All data is for nonprofit, charitable purposes only</p>
        <p>Last updated: <span id="last-updated">-</span></p>
    </div>

    <script>
        // Simulated data - In production, this would come from the IncidentController API
        let dashboardData = {
            severity_counts: { red: 5, yellow: 12, green: 23 },
            total_incidents: 40,
            risk_categories: {
                red: [
                    { institution: "State Correctional Facility", fsi_score: 125.5, incident_count: 8 },
                    { institution: "County Detention Center", fsi_score: 98.2, incident_count: 6 }
                ],
                yellow: [
                    { institution: "Metro Police Department", fsi_score: 67.3, incident_count: 4 },
                    { institution: "Regional Hospital", fsi_score: 54.1, incident_count: 3 }
                ],
                green: [
                    { institution: "City Hall", fsi_score: 12.1, incident_count: 2 }
                ]
            },
            recent_incidents: [
                { 
                    institution: "State Correctional Facility", 
                    severity: "red", 
                    date: "2024-12-01",
                    act_violated: "Use of excessive force during routine check"
                },
                { 
                    institution: "County Detention Center", 
                    severity: "yellow", 
                    date: "2024-11-30",
                    act_violated: "Failure to provide medical attention"
                },
                { 
                    institution: "Metro Police Department", 
                    severity: "yellow", 
                    date: "2024-11-29",
                    act_violated: "Improper detention procedures"
                }
            ],
            pending_approvals: [
                { 
                    institution: "Regional Hospital", 
                    severity: "yellow",
                    submitted_by: "watcher_03"
                }
            ],
            last_updated: new Date().toISOString()
        };

        function loadDashboardData() {
            // In production, this would be an API call to the IncidentController
            // For demo purposes, we'll use the simulated data
            updateDashboard(dashboardData);
        }

        function updateDashboard(data) {
            // Update incident counts
            document.getElementById('total-incidents').textContent = `Total Incidents: ${data.total_incidents}`;
            document.getElementById('red-count').textContent = data.severity_counts.red;
            document.getElementById('yellow-count').textContent = data.severity_counts.yellow;
            document.getElementById('green-count').textContent = data.severity_counts.green;

            // Show alerts for pending approvals
            if (data.pending_approvals && data.pending_approvals.length > 0) {
                const alertContainer = document.getElementById('alert-container');
                alertContainer.innerHTML = `
                    <div class="alert">
                        <strong>‚è≥ Pending Approvals</strong>
                        ${data.pending_approvals.length} incident(s) awaiting Archangel node approval
                    </div>
                `;
            }

            // Update high risk institutions
            const riskContainer = document.getElementById('risk-institutions');
            if (data.risk_categories.red.length > 0) {
                riskContainer.innerHTML = data.risk_categories.red.map(inst => `
                    <div class="institution-item">
                        <div>
                            <span class="status-indicator status-red"></span>
                            ${inst.institution}
                        </div>
                        <span class="fsi-score fsi-red">FSI ${inst.fsi_score}</span>
                    </div>
                `).join('');
            } else {
                riskContainer.innerHTML = '<p>No high-risk institutions at this time.</p>';
            }

            // Update recent incidents
            const incidentsContainer = document.getElementById('recent-incidents');
            incidentsContainer.innerHTML = data.recent_incidents.map(incident => `
                <div class="incident-item incident-${incident.severity}">
                    <strong>${incident.institution}</strong><br>
                    <small>${incident.date} - ${incident.act_violated}</small>
                </div>
            `).join('');

            // Update FSI overview
            const fsiContainer = document.getElementById('fsi-overview');
            const totalInstitutions = Object.values(data.risk_categories).reduce((sum, cat) => sum + cat.length, 0);
            fsiContainer.innerHTML = `
                <p><strong>Total Institutions Monitored:</strong> ${totalInstitutions}</p>
                <div class="severity-counts">
                    <div class="severity-item severity-red">
                        <div>${data.risk_categories.red.length}</div>
                        <div>High Risk</div>
                    </div>
                    <div class="severity-item severity-yellow">
                        <div>${data.risk_categories.yellow.length}</div>
                        <div>Medium Risk</div>
                    </div>
                    <div class="severity-item severity-green">
                        <div>${data.risk_categories.green.length}</div>
                        <div>Low Risk</div>
                    </div>
                </div>
            `;

            // Update timestamp
            document.getElementById('last-updated').textContent = new Date(data.last_updated).toLocaleString();
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            
            // Auto-refresh every 30 seconds
            setInterval(loadDashboardData, 30000);
        });

        // Add some demo functionality
        console.log('SPRAXXX Pantry Divine Court Dashboard loaded');
        console.log('This is a demonstration dashboard. In production, data would be loaded from the IncidentController API.');
    </script>
</body>
</html>